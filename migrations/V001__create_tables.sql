-- V001__create_tables.sql

-- Создание таблицы product для хранения информации о продуктах
CREATE TABLE IF NOT EXISTS product(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Добавлен PRIMARY KEY
    name VARCHAR(255) NOT NULL,
    picture_url VARCHAR(255)
    -- Столбец price будет добавлен в V002
);

-- Создание таблицы orders для хранения информации о заказах
CREATE TABLE IF NOT EXISTS orders(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- Добавлен PRIMARY KEY
    status VARCHAR(255) NOT NULL -- Статус не должен быть NULL
    -- Столбец date_created будет добавлен в V002
);

-- Создание таблицы order_product для связи заказов и продуктов (многие ко многим)
CREATE TABLE IF NOT EXISTS order_product(
    quantity INTEGER NOT NULL,
    order_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    PRIMARY KEY (order_id, product_id), -- Составной первичный ключ
    FOREIGN KEY (order_id) REFERENCES orders(id), -- Внешний ключ к таблице orders
    FOREIGN KEY (product_id) REFERENCES product(id) -- Внешний ключ к таблице product
);

-- Таблицы product_info и orders_date создавались и удалялись в более ранних версиях,
-- теперь их определения полностью удалены из V001, а удаление происходит в V002.